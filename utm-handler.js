(()=>{"use strict";function t(t){if("complete"===document.readyState)return t();window.addEventListener("load",t)}function n(t){const n=this;return{get:()=>n.get(t),set:e=>n.set(t,e)}}function e(t){return{context:n,get:n=>t.getItem(n)??void 0,set(n,e){t.setItem(n,e)}}}const i={local:e(localStorage),session:e(sessionStorage)};!function(n){const e=(...t)=>{},r=(...t)=>{},a={token:"",clickIdParam:"click_id",pixelIdParam:"pixel_id",stepId:"initial",currentUrl:new URL(window.location.href),campaignIdParam:"CampaignID",fingerPrintId:void 0},o={pixelIdParam:!0,clickIdParam:!0,campaignIdParam:!0},c="utm_source";function s(t){return Object.keys(t)}function u(){return document.currentScript}function d(){const t=u();return t?.getAttribute("data-token")}async function l(){const t=i.local.context(`KWAI_UTM_TRACK_${a.token}`),n=Object.fromEntries(new URLSearchParams(window.location.search)),o=n[a.clickIdParam]||null,s=n[a.pixelIdParam]||"",u=n[a.campaignIdParam]||"",d={token:a.token,clickId:o,pixelId:s,campaignId:u},l=function({token:t,clickId:n,pixelId:e,campaignId:i}){return[t,n,e,i].join("::")}(d);e({urlParams:n,clickId:o,utmValue:l});let p=null;if(o?(p=l,t.get()&&t.get()?.startsWith(l)||t.set(l)):p=t.get(),p){async function m(t){const n=function(t,n){const e={};for(const i in t)n(t[i],i,t)&&(e[i]=t[i]);return e}({href:a.currentUrl.href,utm_source:t,step_id:a.stepId,finger_print_id:a.fingerPrintId??await f.promise.promise,campaign_id:d.campaignId,click_id:d.clickId||void 0,pixel_id:d.pixelId,product_id:d.token},Boolean);await async function(t){if(function(t){const n="PREVIOUS_PAGE_VIEW",e=JSON.parse(sessionStorage.getItem(n)??"[]"),i=new Set(e),r=JSON.stringify(t);return!!i.has(r)||(i.add(r),sessionStorage.setItem(n,JSON.stringify([...i.values()])),!1)}(t))return!0;if(t.click_id)return async function(){try{return e("VIEW",{data:t}),await fetch("https://view.xtracky.dev/api/analytics/view",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(3e3),keepalive:!0}),!0}catch(t){return r("Erro ao enviar view:",t),!1}}()}(n)}a.currentUrl.searchParams.set(c,p),window.history.pushState({},"",a.currentUrl.toString()),m(p),function(t){document.querySelectorAll("a").forEach((n=>{if(!n.href||n.href.startsWith("#"))return;const i=a.currentUrl.searchParams;i.set(c,t),e("link.search",n.search);const r=new URLSearchParams(n.search);for(const t of i)r.set(...t);const o=new URL(n.href);o.search=r.toString(),n.href=o.href}))}(p)}}async function f(){a.fingerPrintId=await async function(){const t=await async function(t){return new Function(`return import("${t}")`)()}("https://cdn.skypack.dev/@fingerprintjs/fingerprintjs@4.0.1").then((t=>t.default)),n=await t.load().then((t=>t.get()));return n.visitorId}(),f.promise.resolve(a.fingerPrintId)}function p(){try{return window.self!==window.top}catch(t){return!0}}e({config:a}),f.promise=function(){const t={};return t.promise=new Promise(((n,e)=>{Object.assign(t,{resolve:n,reject:e})})),t}(),async function(){(function(){const t=u();t&&Object.assign(a,{token:d()||"",clickIdParam:t.getAttribute("data-click-id-param")||"click_id",pixelIdParam:t.getAttribute("data-pixel-id-param")||"pixel_id",campaignIdParam:t.getAttribute("data-campaign-id")||"CampaignID",stepId:t.getAttribute("data-step-id")||"initial",currentUrl:new URL(window.location.href)})})(),f(),await t(l),function(){n.shouldEnableInterception&&function(){function t(){if(!p())return;const t=window.open;window.open=function(n,e,...i){if(p()&&"_top"===e){const r=d(n);if(r)return t.call(this,u(r.href),e,...i)}return t.apply(this,arguments)}}function n(){if(l(),window.navigation)return t();function t(){let t;window.navigation?.addEventListener("navigate",(n=>{const e=window.navigation;function i(n,i){const r=!n.destination.sameDocument;if(t=i,r)return e.navigate(i,{history:"push"===n.navigationType?"push":"replace"===n.navigationType?"replace":"auto"});history.pushState({},"",i)}function r(n){return t!==n.destination.url}n?.destination?.url&&(!function(t,n){try{return t()}catch{return n}}((()=>{n.destination.url=n?.destination?.url?.href??n?.destination?.url})),r(n)&&(n.preventDefault(),i(n,u(n.destination.url))))}))}window.addEventListener("navigationReady",t)}function e(){const t=new URLSearchParams(window.location.search);return r(Object.fromEntries([...s(o).map((t=>a[t])),c].map((n=>[n,i(n,t)]))))}function i(t,n=new URLSearchParams(window.location.search)){return n.get(t)??void 0}function r(t){const n={};for(const e in t)null!=t[e]&&(n[e]=t[e]);return n}function u(t){return n({url:t,search:[new URLSearchParams(e()),t]});function n({url:t,search:n}){const e=new URL(t),i=r(Object.assign({},...n.map(a).map(Object.fromEntries)));return e.search=new URLSearchParams(i).toString(),e.href;function a(t){return t instanceof URLSearchParams?t:t instanceof URL?t.searchParams:d(t)?.searchParams??new URLSearchParams(t)}}}function d(t){try{return t instanceof URL?t:new URL(t)}catch{return}}function l(){if(window.navigation)window.dispatchEvent(new Event("navigationReady"));else{const t=document.createElement("script");t.type="module",t.textContent="\n                    // Import the polyfill from Skypack\n                    import * as navigationPolyfill from 'https://cdn.skypack.dev/navigation-api-polyfill';\n                    window.dispatchEvent(new Event('navigationReady'));\n                ",document.head.appendChild(t)}}t(),n()}();!function(n,e,i=document){t((()=>{e(i.querySelectorAll(n)),new MutationObserver((t=>{t.forEach((t=>{t.addedNodes&&t.addedNodes.length>0&&t.addedNodes.forEach((t=>{t instanceof Element&&(t.matches(n)&&e([t]),e(t.querySelectorAll(n)))}))}))})).observe(i,{childList:!0,subtree:!0})}))}("iframe",(t=>t.forEach((t=>{if(t.src){const n=new URL(t.src);n.search=new URLSearchParams({...Object.fromEntries(new URLSearchParams(window.location.search)),...Object.fromEntries(n.searchParams)}).toString(),t.src=n.href}}))))}()}()}({shouldEnableInterception:!1})})();